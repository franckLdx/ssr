import{S as g,s as j,h as d,g as C,n as m,u as h,r as c,a as v,b as w,c as O,j as e,T as p,d as f,e as y,f as P,B as l,i as S,R as I,L as R}from"./main-BywWb2uP.js";var E=class extends g{#s;#r=void 0;#t;#e;constructor(t,s){super(),this.#s=t,this.setOptions(s),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const s=this.options;this.options=this.#s.defaultMutationOptions(t),j(this.options,s)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),s?.mutationKey&&this.options.mutationKey&&d(s.mutationKey)!==d(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#n(t)}getCurrentResult(){return this.#r}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#i(),this.#n()}mutate(t,s){return this.#e=s,this.#t?.removeObserver(this),this.#t=this.#s.getMutationCache().build(this.#s,this.options),this.#t.addObserver(this),this.#t.execute(t)}#i(){const t=this.#t?.state??C();this.#r={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#n(t){m.batch(()=>{if(this.#e&&this.hasListeners()){const s=this.#r.variables,r=this.#r.context,i={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};t?.type==="success"?(this.#e.onSuccess?.(t.data,s,r,i),this.#e.onSettled?.(t.data,null,s,r,i)):t?.type==="error"&&(this.#e.onError?.(t.error,s,r,i),this.#e.onSettled?.(void 0,t.error,s,r,i))}this.listeners.forEach(s=>{s(this.#r)})})}};function b(t,s){const r=h(s),[i]=c.useState(()=>new E(r,t));c.useEffect(()=>{i.setOptions(t)},[i,t]);const n=c.useSyncExternalStore(c.useCallback(a=>i.subscribe(m.batchCalls(a)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),o=c.useCallback((a,x)=>{i.mutate(a,x).catch(v)},[i]);if(n.error&&w(i.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:o,mutateAsync:n.mutate}}function N({categoryId:t}){const s=O(t);return e.jsx(p.H1,{className:"text-center pt-8 mb-16",children:s.data?.description})}function F({children:t}){return e.jsx("div",{className:"border rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow p-4 w-128",children:t})}function M({children:t}){return e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"border-0 h-1 bg-black my-4 w-full"}),t]})}const u={Border:F,Title:p.H2,Footer:M};function T(){return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})}const k=()=>{const t=f(),s=h();return b({mutationFn:async r=>{const n=[...t.data?.products??[],{productId:r.id,quantity:1}],o=await fetch("http://localhost:3000/carts/1",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({products:n})});if(!o.ok)throw new Error("Failed to add item to cart");return o.json()},onSuccess:r=>{s.setQueryData(y(),r)}})},K=()=>{const t=f(),s=h();return b({mutationFn:async r=>{const n=(t.data?.products??[]).filter(a=>a.productId!==r.id),o=await fetch("http://localhost:3000/carts/1",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({products:n})});if(!o.ok)throw new Error("Failed to add item to cart");return o.json()},onSuccess:r=>{s.setQueryData(y(),r)}})};function A({product:t}){const s=P(t.id),r=k(),i=()=>r.mutate(t),n=K(),o=()=>n.mutate(t);return s===void 0?null:r.isPending||n.isPending?e.jsx(T,{}):s?e.jsx(l,{onClick:o,children:"Retirer du panier"}):e.jsx(l,{onClick:i,children:"Ajouter au panier"})}function B({product:t}){return e.jsxs(u.Border,{children:[e.jsx(u.Title,{children:t.title}),e.jsx("img",{src:t.image,alt:"","aria-hidden":!0,className:"mx-auto block"}),e.jsx("p",{className:"pt-2",children:t.description}),e.jsxs("p",{className:"pt-2",children:["Rating: ",t.rating.rate,"/",t.rating.count]}),e.jsx(u.Footer,{children:e.jsx(A,{product:t})})]})}function H({categoryId:t}){const s=S(t);return e.jsx("ul",{className:"flex flex-wrap gap-8 list-none p-0 m-0",children:s.data?.map(r=>e.jsx("li",{className:"w-full sm:w-auto",children:e.jsx(B,{product:r})},r.id))})}function Q(){const{categoryId:t}=I.useParams();return e.jsx(R,{children:e.jsxs("section",{children:[e.jsx(N,{categoryId:t}),e.jsx(H,{categoryId:t})]})})}export{Q as component};
