import{S as M,n as g,s as k,o as L,Q as C,u as B,q as I,t as A,r as b,v as H,w as T,x as z,a as D,y as Q,z as j,A as N,C as F,j as u,c as x,D as w,e as S,L as q,E as U,F as W,B as Y}from"./main-C3Drosqm.js";import{P as _}from"./PageHeader-TaVuhhk7.js";function E(s,e){const n=new Set(e);return s.filter(r=>!n.has(r))}function G(s,e,n){const r=s.slice(0);return r[e]=n,r}var J=class extends M{#r;#e;#n;#i;#s;#t;#u;#o;#c=[];constructor(s,e,n){super(),this.#r=s,this.#i=n,this.#n=[],this.#s=[],this.#e=[],this.setQueries(e)}onSubscribe(){this.listeners.size===1&&this.#s.forEach(s=>{s.subscribe(e=>{this.#d(s,e)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#s.forEach(s=>{s.destroy()})}setQueries(s,e){this.#n=s,this.#i=e,g.batch(()=>{const n=this.#s,r=this.#l(this.#n);this.#c=r,r.forEach(o=>o.observer.setOptions(o.defaultedQueryOptions));const t=r.map(o=>o.observer),c=t.map(o=>o.getCurrentResult()),i=n.length!==t.length,h=t.some((o,p)=>o!==n[p]),l=i||h,y=l?!0:c.some((o,p)=>{const m=this.#e[p];return!m||!k(o,m)});!l&&!y||(l&&(this.#s=t),this.#e=c,this.hasListeners()&&(l&&(E(n,t).forEach(o=>{o.destroy()}),E(t,n).forEach(o=>{o.subscribe(p=>{this.#d(o,p)})})),this.#p()))})}getCurrentResult(){return this.#e}getQueries(){return this.#s.map(s=>s.getCurrentQuery())}getObservers(){return this.#s}getOptimisticResult(s,e){const n=this.#l(s),r=n.map(t=>t.observer.getOptimisticResult(t.defaultedQueryOptions));return[r,t=>this.#h(t??r,e),()=>this.#a(r,n)]}#a(s,e){return e.map((n,r)=>{const t=s[r];return n.defaultedQueryOptions.notifyOnChangeProps?t:n.observer.trackResult(t,c=>{e.forEach(i=>{i.observer.trackProp(c)})})})}#h(s,e){return e?((!this.#t||this.#e!==this.#o||e!==this.#u)&&(this.#u=e,this.#o=this.#e,this.#t=L(this.#t,e(s))),this.#t):s}#l(s){const e=new Map;this.#s.forEach(r=>{const t=r.options.queryHash;if(!t)return;const c=e.get(t);c?c.push(r):e.set(t,[r])});const n=[];return s.forEach(r=>{const t=this.#r.defaultQueryOptions(r),i=e.get(t.queryHash)?.shift()??new C(this.#r,t);n.push({defaultedQueryOptions:t,observer:i})}),n}#d(s,e){const n=this.#s.indexOf(s);n!==-1&&(this.#e=G(this.#e,n,e),this.#p())}#p(){if(this.hasListeners()){const s=this.#t,e=this.#a(this.#e,this.#c),n=this.#h(e,this.#i?.combine);s!==n&&g.batch(()=>{this.listeners.forEach(r=>{r(this.#e)})})}}};function K({queries:s,...e},n){const r=B(n),t=I(),c=A(),i=b.useMemo(()=>s.map(a=>{const f=r.defaultQueryOptions(a);return f._optimisticResults=t?"isRestoring":"optimistic",f}),[s,r,t]);i.forEach(a=>{H(a),T(a,c)}),z(c);const[h]=b.useState(()=>new J(r,i,e)),[l,y,o]=h.getOptimisticResult(i,e.combine),p=!t&&e.subscribed!==!1;b.useSyncExternalStore(b.useCallback(a=>p?h.subscribe(g.batchCalls(a)):D,[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),b.useEffect(()=>{h.setQueries(i,e)},[i,e,h]);const O=l.some((a,f)=>Q(i[f],a))?l.flatMap((a,f)=>{const d=i[f];if(d){const v=new C(r,d);if(Q(d,a))return j(d,v,c);N(a,t)&&j(d,v,c)}return[]}):[];if(O.length>0)throw Promise.all(O);const R=l.find((a,f)=>{const d=i[f];return d&&F({result:a,errorResetBoundary:c,throwOnError:d.throwOnError,query:r.getQueryCache().get(d.queryHash),suspense:d.suspense})});if(R?.error)throw R.error;return y(o())}function P({amount:s}){return u.jsxs("span",{children:[s," €"]})}function V({cartItem:s}){const e=x(w(s.productId)).data;return u.jsxs("p",{className:"m-10 p-6 border-2 flex justify-between",children:[e.title," ",u.jsxs("span",{children:[e.price," x ",s.quantity," = ",u.jsx(P,{amount:e.price*s.quantity})]})]})}function X(){const s=x(S);return u.jsx("ul",{children:s.data?.products.map(e=>u.jsx("li",{children:u.jsx(q,{children:u.jsx(V,{cartItem:e})})},e.productId))})}function Z(){const s=x(S).data,e=K({queries:s.products.map(t=>w(t.productId))}),n=e.every(t=>t.isSuccess),r=b.useMemo(()=>e.reduce((t,c)=>{const i=c.data;if(!i)return t;const h=s.products.find(l=>l.productId===i.id);return h?t+i.price*h.quantity:t},0)||0,[s,n,e]);return n?u.jsx(P,{amount:r}):u.jsx("span",{children:"Computing..."})}function se(){return u.jsxs("section",{children:[u.jsx(_,{children:u.jsxs(q,{children:["Your Cart - ",u.jsx(Z,{})]})}),u.jsx(X,{}),u.jsx("div",{className:"mt-4 flex justify-center",children:u.jsx(U,{to:W.to,children:u.jsx(Y,{className:"px-32 py-8",children:"Payment"})})})]})}export{se as component};
