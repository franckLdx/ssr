import{S as j,s as C,h as d,g as v,n as p,u as h,r as c,a as w,b as O,c as S,j as e,T as y,d as f,e as b,f as P,B as l,i as I,k as m,L as E}from"./main-BzESYTLN.js";import{H as N}from"./HydrationBoundary-BYDxGHzL.js";var R=class extends j{#s;#r=void 0;#t;#e;constructor(t,s){super(),this.#s=t,this.setOptions(s),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const s=this.options;this.options=this.#s.defaultMutationOptions(t),C(this.options,s)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),s?.mutationKey&&this.options.mutationKey&&d(s.mutationKey)!==d(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#n(t)}getCurrentResult(){return this.#r}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#i(),this.#n()}mutate(t,s){return this.#e=s,this.#t?.removeObserver(this),this.#t=this.#s.getMutationCache().build(this.#s,this.options),this.#t.addObserver(this),this.#t.execute(t)}#i(){const t=this.#t?.state??v();this.#r={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#n(t){p.batch(()=>{if(this.#e&&this.hasListeners()){const s=this.#r.variables,r=this.#r.context,i={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};t?.type==="success"?(this.#e.onSuccess?.(t.data,s,r,i),this.#e.onSettled?.(t.data,null,s,r,i)):t?.type==="error"&&(this.#e.onError?.(t.error,s,r,i),this.#e.onSettled?.(void 0,t.error,s,r,i))}this.listeners.forEach(s=>{s(this.#r)})})}};function x(t,s){const r=h(s),[i]=c.useState(()=>new R(r,t));c.useEffect(()=>{i.setOptions(t)},[i,t]);const n=c.useSyncExternalStore(c.useCallback(a=>i.subscribe(p.batchCalls(a)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),o=c.useCallback((a,g)=>{i.mutate(a,g).catch(w)},[i]);if(n.error&&O(i.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:o,mutateAsync:n.mutate}}function F({categoryId:t}){const s=S(t);return e.jsx(y.H1,{className:"text-center pt-8 mb-16",children:s.data?.description})}function M({children:t}){return e.jsx("div",{className:"border rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow p-4 w-128",children:t})}function T({children:t}){return e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"border-0 h-1 bg-black my-4 w-full"}),t]})}const u={Border:M,Title:y.H2,Footer:T};function k(){return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})}const K=()=>{const t=f(),s=h();return x({mutationFn:async r=>{const n=[...t.data?.products??[],{productId:r.id,quantity:1}],o=await fetch("http://localhost:3000/carts/1",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({products:n})});if(!o.ok)throw new Error("Failed to add item to cart");return o.json()},onSuccess:r=>{s.setQueryData(b(),r)}})},H=()=>{const t=f(),s=h();return x({mutationFn:async r=>{const n=(t.data?.products??[]).filter(a=>a.productId!==r.id),o=await fetch("http://localhost:3000/carts/1",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({products:n})});if(!o.ok)throw new Error("Failed to add item to cart");return o.json()},onSuccess:r=>{s.setQueryData(b(),r)}})};function A({product:t}){const s=P(t.id),r=K(),i=()=>r.mutate(t),n=H(),o=()=>n.mutate(t);return s===void 0?null:r.isPending||n.isPending?e.jsx(k,{}):s?e.jsx(l,{onClick:o,children:"Retirer du panier"}):e.jsx(l,{onClick:i,children:"Ajouter au panier"})}function B({product:t}){return e.jsxs(u.Border,{children:[e.jsx(u.Title,{children:t.title}),e.jsx("img",{src:t.image,alt:"","aria-hidden":!0,className:"mx-auto block"}),e.jsx("p",{className:"pt-2",children:t.description}),e.jsxs("p",{className:"pt-2",children:["Rating: ",t.rating.rate,"/",t.rating.count]}),e.jsx(u.Footer,{children:e.jsx(A,{product:t})})]})}function L({categoryId:t}){const s=I(t);return e.jsx("ul",{className:"flex flex-wrap gap-8 list-none p-0 m-0",children:s.data?.map(r=>e.jsx("li",{className:"w-full sm:w-auto",children:e.jsx(B,{product:r})},r.id))})}function D(){const{dehydratedState:t}=m.useLoaderData(),{categoryId:s}=m.useParams();return e.jsx(N,{state:t,children:e.jsx(E,{children:e.jsxs("section",{children:[e.jsx(F,{categoryId:s}),e.jsx(L,{categoryId:s})]})})})}export{D as component};
