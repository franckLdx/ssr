import{S as M,n as g,s as k,r as L,Q as C,u as I,a as H,b as A,c as b,e as B,d as T,f as z,g as D,h as Q,i as E,w as U,k as F,j as c,l as O,m as j,o as S,L as q}from"./main-D7Fvl1Tg.js";import{P as N}from"./PageHeader-B6WWkyST.js";function w(e,s){const r=new Set(s);return e.filter(n=>!r.has(n))}function W(e,s,r){const n=e.slice(0);return n[s]=r,n}var Y=class extends M{#r;#e;#n;#i;#s;#t;#u;#o;#c=[];constructor(e,s,r){super(),this.#r=e,this.#i=r,this.#n=[],this.#s=[],this.#e=[],this.setQueries(s)}onSubscribe(){this.listeners.size===1&&this.#s.forEach(e=>{e.subscribe(s=>{this.#d(e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#s.forEach(e=>{e.destroy()})}setQueries(e,s){this.#n=e,this.#i=s,g.batch(()=>{const r=this.#s,n=this.#l(this.#n);this.#c=n,n.forEach(i=>i.observer.setOptions(i.defaultedQueryOptions));const t=n.map(i=>i.observer),o=t.map(i=>i.getCurrentResult()),u=r.length!==t.length,h=t.some((i,p)=>i!==r[p]),l=u||h,y=l?!0:o.some((i,p)=>{const m=this.#e[p];return!m||!k(i,m)});!l&&!y||(l&&(this.#s=t),this.#e=o,this.hasListeners()&&(l&&(w(r,t).forEach(i=>{i.destroy()}),w(t,r).forEach(i=>{i.subscribe(p=>{this.#d(i,p)})})),this.#p()))})}getCurrentResult(){return this.#e}getQueries(){return this.#s.map(e=>e.getCurrentQuery())}getObservers(){return this.#s}getOptimisticResult(e,s){const r=this.#l(e),n=r.map(t=>t.observer.getOptimisticResult(t.defaultedQueryOptions));return[n,t=>this.#h(t??n,s),()=>this.#a(n,r)]}#a(e,s){return s.map((r,n)=>{const t=e[n];return r.defaultedQueryOptions.notifyOnChangeProps?t:r.observer.trackResult(t,o=>{s.forEach(u=>{u.observer.trackProp(o)})})})}#h(e,s){return s?((!this.#t||this.#e!==this.#o||s!==this.#u)&&(this.#u=s,this.#o=this.#e,this.#t=L(this.#t,s(e))),this.#t):e}#l(e){const s=new Map(this.#s.map(n=>[n.options.queryHash,n])),r=[];return e.forEach(n=>{const t=this.#r.defaultQueryOptions(n),o=s.get(t.queryHash);o?r.push({defaultedQueryOptions:t,observer:o}):r.push({defaultedQueryOptions:t,observer:new C(this.#r,t)})}),r}#d(e,s){const r=this.#s.indexOf(e);r!==-1&&(this.#e=W(this.#e,r,s),this.#p())}#p(){if(this.hasListeners()){const e=this.#t,s=this.#a(this.#e,this.#c),r=this.#h(s,this.#i?.combine);e!==r&&g.batch(()=>{this.listeners.forEach(n=>{n(this.#e)})})}}};function _({queries:e,...s},r){const n=I(r),t=H(),o=A(),u=b.useMemo(()=>e.map(a=>{const f=n.defaultQueryOptions(a);return f._optimisticResults=t?"isRestoring":"optimistic",f}),[e,n,t]);u.forEach(a=>{B(a),T(a,o)}),z(o);const[h]=b.useState(()=>new Y(n,u,s)),[l,y,i]=h.getOptimisticResult(u,s.combine),p=!t&&s.subscribed!==!1;b.useSyncExternalStore(b.useCallback(a=>p?h.subscribe(g.batchCalls(a)):D,[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),b.useEffect(()=>{h.setQueries(u,s)},[u,s,h]);const R=l.some((a,f)=>Q(u[f],a))?l.flatMap((a,f)=>{const d=u[f];if(d){const v=new C(n,d);if(Q(d,a))return E(d,v,o);U(a,t)&&E(d,v,o)}return[]}):[];if(R.length>0)throw Promise.all(R);const x=l.find((a,f)=>{const d=u[f];return d&&F({result:a,errorResetBoundary:o,throwOnError:d.throwOnError,query:n.getQueryCache().get(d.queryHash),suspense:d.suspense})});if(x?.error)throw x.error;return y(i())}function P({amount:e}){return c.jsxs("span",{children:[e," €"]})}function G({cartItem:e}){const s=O(j(e.productId)).data;return c.jsxs("p",{className:"m-10 p-6 border-2 flex justify-between",children:[s.title," ",c.jsxs("span",{children:[s.price," x ",e.quantity," = ",c.jsx(P,{amount:s.price*e.quantity})]})]})}function J(){const e=O(S);return c.jsx("ul",{children:e.data?.products.map(s=>c.jsx("li",{children:c.jsx(q,{children:c.jsx(G,{cartItem:s})})},s.productId))})}function K(){const e=O(S).data,s=_({queries:e.products.map(t=>j(t.productId))}),r=s.every(t=>t.isSuccess),n=b.useMemo(()=>s.reduce((t,o)=>{const u=o.data;if(!u)return t;const h=e.products.find(l=>l.productId===u.id);return h?t+u.price*h.quantity:t},0)||0,[e,r,s]);return r?c.jsx(P,{amount:n}):c.jsx("span",{children:"Computing..."})}function Z(){return c.jsxs("section",{children:[c.jsx(N,{children:c.jsxs(q,{children:["Your Cart - ",c.jsx(K,{})]})}),c.jsx(J,{})]})}export{Z as component};
