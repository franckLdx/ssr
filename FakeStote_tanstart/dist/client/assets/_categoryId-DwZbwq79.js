import{S as x,s as j,h as d,g as C,n as m,a as h,r as u,b as v,d as w,e as O,j as e,T as P,u as p,c as y,f,i as S,B as l,k as I,R,L as E}from"./main-DyPt28Sk.js";import{P as M}from"./PageHeader-C2rZQrQb.js";var N=class extends x{#s;#r=void 0;#t;#e;constructor(t,s){super(),this.#s=t,this.setOptions(s),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const s=this.options;this.options=this.#s.defaultMutationOptions(t),j(this.options,s)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),s?.mutationKey&&this.options.mutationKey&&d(s.mutationKey)!==d(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#n(t)}getCurrentResult(){return this.#r}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#i(),this.#n()}mutate(t,s){return this.#e=s,this.#t?.removeObserver(this),this.#t=this.#s.getMutationCache().build(this.#s,this.options),this.#t.addObserver(this),this.#t.execute(t)}#i(){const t=this.#t?.state??C();this.#r={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#n(t){m.batch(()=>{if(this.#e&&this.hasListeners()){const s=this.#r.variables,r=this.#r.context,i={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};t?.type==="success"?(this.#e.onSuccess?.(t.data,s,r,i),this.#e.onSettled?.(t.data,null,s,r,i)):t?.type==="error"&&(this.#e.onError?.(t.error,s,r,i),this.#e.onSettled?.(void 0,t.error,s,r,i))}this.listeners.forEach(s=>{s(this.#r)})})}};function b(t,s){const r=h(s),[i]=u.useState(()=>new N(r,t));u.useEffect(()=>{i.setOptions(t)},[i,t]);const n=u.useSyncExternalStore(u.useCallback(a=>i.subscribe(m.batchCalls(a)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),o=u.useCallback((a,g)=>{i.mutate(a,g).catch(v)},[i]);if(n.error&&w(i.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:o,mutateAsync:n.mutate}}function T({categoryId:t}){const s=O(t);return e.jsx(M,{children:s.data?.description})}function F({children:t}){return e.jsx("div",{className:"border rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow p-4 w-128",children:t})}function k({children:t}){return e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"border-0 h-1 bg-black my-4 w-full"}),t]})}const c={Border:F,Title:P.H2,Footer:k};function K(){return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})}const Q=()=>{const t=p(y),s=h();return b({mutationFn:async r=>{const n=[...t.data?.products??[],{productId:r.id,quantity:1}],o=await fetch("http://localhost:3000/carts/1",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({products:n})});if(!o.ok)throw new Error("Failed to add item to cart");return o.json()},onSuccess:r=>{s.setQueryData(f(),r)}})},A=()=>{const t=p(y),s=h();return b({mutationFn:async r=>{const n=(t.data?.products??[]).filter(a=>a.productId!==r.id),o=await fetch("http://localhost:3000/carts/1",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({products:n})});if(!o.ok)throw new Error("Failed to add item to cart");return o.json()},onSuccess:r=>{s.setQueryData(f(),r)}})};function B({product:t}){const s=S(t.id),r=Q(),i=()=>r.mutate(t),n=A(),o=()=>n.mutate(t);return s===void 0?null:r.isPending||n.isPending?e.jsx(K,{}):s?e.jsx(l,{onClick:o,children:"Retirer du panier"}):e.jsx(l,{onClick:i,children:"Ajouter au panier"})}function H({product:t}){return e.jsxs(c.Border,{children:[e.jsx(c.Title,{children:t.title}),e.jsx("img",{src:t.image,alt:"","aria-hidden":!0,className:"mx-auto block"}),e.jsx("p",{className:"pt-2",children:t.description}),e.jsxs("p",{className:"pt-2",children:["Rating: ",t.rating.rate,"/",t.rating.count]}),e.jsx(c.Footer,{children:e.jsx(B,{product:t})})]})}function L({categoryId:t}){const s=I(t);return e.jsx("ul",{className:"flex flex-wrap gap-8 list-none p-0 m-0",children:s.data?.map(r=>e.jsx("li",{className:"w-full sm:w-auto",children:e.jsx(H,{product:r})},r.id))})}function U(){const{categoryId:t}=R.useParams();return e.jsx(E,{children:e.jsxs("section",{children:[e.jsx(T,{categoryId:t}),e.jsx(L,{categoryId:t})]})})}export{U as component};
